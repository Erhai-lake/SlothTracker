import{a}from"./index-NIGUFBhG.js";import{_ as h,r as f,c as w,o as p,a as u,w as l,b as r,h as n,v as c,d,i as F,g}from"./index-hfvNnKQ2.js";import{T as b,a as y}from"./TabsTab-Z4Q6VWjj.js";const I={name:"Config",components:{TabsTab:y,Tabs:b},data(){return{activeTab:"regular",config:{},regularForm:{serverUrl:"",refreshInterval:5,background:!0},deviceForm:{name:"",description:""},writeOffDeviceConfirm:1,accountForm:{oldName:"",newName:"",oldPassword:"",newPassword:""},writeOffAccountConfirm:1}},mounted(){this.config=JSON.parse(localStorage.getItem("config")),this.getRegularInfo(),this.getDeviceInfo(),this.getAccountInfo()},methods:{async getRegularInfo(){this.regularForm.serverUrl=this.config.serverUrl,this.regularForm.refreshInterval=this.config.refreshInterval,this.regularForm.background=this.config.background},async ping(){if(this.regularForm.serverUrl===""){this.$toast.warning("请填写完整信息");return}try{const t=await a.get(`${this.regularForm.serverUrl}/api/ping`,{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error("服务器地址错误");return}this.$toast.success(`服务器延迟: ${t.data.message}`)}catch(t){console.error(t),this.$toast.error("服务器地址错误")}},async saveRegular(){if(this.regularForm.serverUrl===""||this.regularForm.refreshInterval===""){this.$toast.warning("请填写完整信息");return}localStorage.setItem("config",JSON.stringify({...this.config,serverUrl:this.regularForm.serverUrl,refreshInterval:this.regularForm.refreshInterval,background:this.regularForm.background})),this.$toast.success("保存成功")},refresh(){location.reload()},resetConfig(){localStorage.removeItem("config"),location.reload()},async getDeviceInfo(){try{const t=await a.get(`${this.config.serverUrl}/api/device/${this.config.deviceId}`,{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.deviceForm.name=t.data.device.name,this.deviceForm.description=t.data.device.description}catch(t){console.error(t),this.$toast.error("获取设备信息错误")}},async saveDevice(){if(this.deviceForm.name===""||this.deviceForm.description===""){this.$toast.warning("请填写完整信息");return}try{const t=await a.put(`${this.config.serverUrl}/api/device/update`,{deviceId:this.config.deviceId,name:this.deviceForm.name,platform:"windows",description:this.deviceForm.description},{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.$toast.success(t.data.message)}catch(t){console.error(t),this.$toast.error("保存设备信息错误")}},async writeOffDevice(){if(this.writeOffDeviceConfirm===1)this.writeOffDeviceConfirm=2,this.$toast.warning("请再次点击确认是否继续注销, 3秒后重置注销状态"),this.$toast.error("注销账户后将删除当前设备的设备信息且无法恢复"),setTimeout(()=>{this.writeOffDeviceConfirm=1},3e3);else if(this.writeOffDeviceConfirm===2){this.$toast.clear();try{const e=await a.delete(`${this.config.serverUrl}/api/device/delete`,{data:{id:this.config.deviceId},validateStatus:()=>!0});if(e.data.code!==0){this.$toast.error(e.data.message);return}this.$toast.success(e.data.message)}catch(e){console.error(e),this.$toast.error("注销账设备错误");return}const t=JSON.parse(localStorage.getItem("config"));localStorage.setItem("config",JSON.stringify({...t,deviceId:""})),this.$router.push("/init"),g.emit("initConfig"),this.$toast.warning("感谢使用, 再见!")}},async getAccountInfo(){try{const t=await a.get(`${this.config.serverUrl}/api/user/${this.config.userId}`,{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.accountForm.oldName=t.data.user.name,this.accountForm.newName=t.data.user.name}catch(t){console.error(t),this.$toast.error("获取账户信息错误")}},saveAccount(){this.accountForm.name!==""&&this.accountForm.oldName!==this.accountForm.newName&&this.resetAccountName(),this.accountForm.oldPassword!==""&&this.accountForm.newPassword!==""&&this.resetAccountPassword()},async resetAccountName(){try{const t=await a.put(`${this.config.serverUrl}/api/user/reset_name`,{id:this.config.userId,name:this.accountForm.newName},{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.$toast.success(t.data.message),this.accountForm.oldName=this.accountForm.newName}catch(t){console.error(t),this.$toast.error("保存账户信息错误")}},async resetAccountPassword(){try{const t=await a.put(`${this.config.serverUrl}/api/user/reset_password`,{id:this.config.userId,old_password:this.accountForm.oldPassword,new_password:this.accountForm.newPassword},{validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.$toast.success(t.data.message)}catch(t){console.error(t),this.$toast.error("保存账户信息错误")}},async writeOffAccount(){if(this.writeOffAccountConfirm===1)this.writeOffAccountConfirm=2,this.$toast.warning("请再次点击确认是否继续注销, 3秒后重置注销状态"),this.$toast.error("注销账户后将删除所有设备信息且无法恢复"),setTimeout(()=>{this.writeOffAccountConfirm=1},3e3);else if(this.writeOffAccountConfirm===2){if(this.$toast.clear(),this.accountForm.oldPassword===""||this.accountForm.newPassword===""){this.$toast.warning("请在密码框中输入两遍密码!");return}if(this.accountForm.oldPassword!==this.accountForm.newPassword){this.$toast.warning("两次输入的密码不一致!");return}try{const t=await a.delete(`${this.config.serverUrl}/api/user/delete`,{data:{id:this.config.userId,password:this.accountForm.oldPassword},validateStatus:()=>!0});if(t.data.code!==0){this.$toast.error(t.data.message);return}this.$toast.success(t.data.message)}catch(t){console.error(t),this.$toast.error("注销账户错误");return}localStorage.removeItem("config"),this.$router.push("/init"),g.emit("initConfig"),this.$toast.warning("感谢使用, 再见!")}}}},C={class:"config"},S={class:"container"},U={class:"form-item"},N={class:"form-item"},O={class:"form-item"},k={class:"form-item-but"},$={class:"form-item-but"},A={class:"container"},P={class:"form-item"},D={class:"form-item"},V={class:"form-item-but"},R={class:"container"},T={class:"form-item"},x={class:"form-item"},E={class:"form-item-but"};function B(t,e,J,M,o,i){const m=f("tabs-tab"),v=f("tabs");return p(),w("div",C,[u(v,{modelValue:o.activeTab,"onUpdate:modelValue":e[16]||(e[16]=s=>o.activeTab=s),class:"type"},{default:l(()=>[u(m,{name:"regular"},{label:l(()=>e[17]||(e[17]=[d("常规",-1)])),default:l(()=>[r("div",S,[r("div",U,[e[18]||(e[18]=r("label",null,"服务器地址：",-1)),n(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.regularForm.serverUrl=s)},null,512),[[c,o.regularForm.serverUrl]])]),r("div",N,[e[19]||(e[19]=r("label",null,"自动刷新时间(秒)：",-1)),n(r("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.regularForm.refreshInterval=s)},null,512),[[c,o.regularForm.refreshInterval]])]),r("div",O,[r("label",null,[e[20]||(e[20]=d(" 背景图开关： ",-1)),n(r("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>o.regularForm.background=s)},null,512),[[F,o.regularForm.background]])])]),r("div",k,[r("button",{onClick:e[3]||(e[3]=(...s)=>i.ping&&i.ping(...s)),style:{"--primary-color":"#3ecd39"}},"测试地址"),r("button",{onClick:e[4]||(e[4]=(...s)=>i.saveRegular&&i.saveRegular(...s))},"保存")]),r("div",$,[r("button",{onClick:e[5]||(e[5]=(...s)=>i.refresh&&i.refresh(...s))},"刷新页面"),r("button",{onClick:e[6]||(e[6]=(...s)=>i.resetConfig&&i.resetConfig(...s)),style:{"--primary-color":"#ff8080"}},"重置设置")])])]),_:1}),u(m,{name:"device"},{label:l(()=>e[21]||(e[21]=[d("设备",-1)])),default:l(()=>[r("div",A,[r("div",P,[e[22]||(e[22]=r("label",null,"设备名称：",-1)),n(r("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.deviceForm.name=s),placeholder:"请输入设备名"},null,512),[[c,o.deviceForm.name]])]),r("div",D,[e[23]||(e[23]=r("label",null,"描述：",-1)),n(r("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.deviceForm.description=s),placeholder:"请输入设备描述"},null,512),[[c,o.deviceForm.description]])]),r("div",V,[r("button",{onClick:e[9]||(e[9]=(...s)=>i.saveDevice&&i.saveDevice(...s))},"保存"),r("button",{onClick:e[10]||(e[10]=(...s)=>i.writeOffDevice&&i.writeOffDevice(...s)),style:{"--primary-color":"#ff8080"}},"注销设备")])])]),_:1}),u(m,{name:"account"},{label:l(()=>e[24]||(e[24]=[d("账户",-1)])),default:l(()=>[r("div",R,[r("div",T,[e[25]||(e[25]=r("label",null,"账户名：",-1)),n(r("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>o.accountForm.newName=s),placeholder:"请输入修改后的用户名"},null,512),[[c,o.accountForm.newName]])]),r("div",x,[e[26]||(e[26]=r("label",null,"重置密码：",-1)),n(r("input",{type:"password","onUpdate:modelValue":e[12]||(e[12]=s=>o.accountForm.oldPassword=s),placeholder:"输入旧密码"},null,512),[[c,o.accountForm.oldPassword]]),n(r("input",{type:"password","onUpdate:modelValue":e[13]||(e[13]=s=>o.accountForm.newPassword=s),placeholder:"输入新密码"},null,512),[[c,o.accountForm.newPassword]])]),r("div",E,[r("button",{onClick:e[14]||(e[14]=(...s)=>i.saveAccount&&i.saveAccount(...s))},"保存"),r("button",{onClick:e[15]||(e[15]=(...s)=>i.writeOffAccount&&i.writeOffAccount(...s)),style:{"--primary-color":"#ff8080"}},"注销账户")])])]),_:1})]),_:1},8,["modelValue"])])}const z=h(I,[["render",B],["__scopeId","data-v-a3097e5e"]]);export{z as default};
