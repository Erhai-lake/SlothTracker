import{a as c}from"./index-NIGUFBhG.js";import{_ as $,r as S,c as i,o as l,a as p,w as d,b as t,d as g,h as _,v as b,F as y,e as I,n as k,t as u,g as z}from"./index-hfvNnKQ2.js";import{T,a as w}from"./TabsTab-Z4Q6VWjj.js";const C={name:"Share",components:{TabsTab:w,Tabs:T},data(){return{activeTab:"applyForSharing",config:{},deviceId:"",shareAuthorizations:[],userApplications:[]}},mounted(){z.on("refresh",this.refresh),this.refresh()},beforeUnmount(){z.off("refresh",this.refresh)},methods:{refresh(){this.config=JSON.parse(localStorage.getItem("config")),this.getShareAuthorizationList(),this.getUserApplicationsList()},formatTime(r){const e=new Date(r),a=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),f=String(e.getMinutes()).padStart(2,"0"),h=String(e.getSeconds()).padStart(2,"0");return`${a}-${m}-${o} ${n}:${f}:${h}`},async applyForSharing(){if(!this.deviceId){this.$toast.error("请输入对方的设备ID");return}try{const r=await c.post(`${this.config.serverUrl}/api/share/apply`,{deviceId:this.deviceId,viewerId:this.config.userId},{validateStatus:()=>!0});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.$toast.success(r.data.message),this.deviceId=""}catch(r){console.error(r),this.$toast.error("申请共享错误")}},async getShareAuthorizationList(){try{const r=await c.get(`${this.config.serverUrl}/api/share/authorizations/${this.config.userId}`,{validateStatus:()=>!0});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.shareAuthorizations=r.data.authorizations}catch(r){console.error(r),this.$toast.error("获取共享授权列表错误")}},async authorization(r,e){if(e===3)try{const a=await c.delete(`${this.config.serverUrl}/api/share/delete`,{data:{id:r},validateStatus:()=>!0});if(a.data.code!==0){this.$toast.error(a.data.message);return}this.$toast.success(a.data.message),await this.getShareAuthorizationList()}catch(a){console.error(a),this.$toast.error("删除错误")}else try{const a=await c.put(`${this.config.serverUrl}/api/share/authorize`,{id:r,status:e},{validateStatus:()=>!0});if(a.data.code!==0){this.$toast.error(a.data.message);return}this.$toast.success(a.data.message),await this.getShareAuthorizationList()}catch(a){console.error(a),this.$toast.error("授权错误")}},async getUserApplicationsList(){try{const r=await c.get(`${this.config.serverUrl}/api/share/${this.config.userId}`,{validateStatus:()=>!0});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.userApplications=r.data.applications}catch(r){console.error(r),this.$toast.error("获取用户申请的授权列表错误")}}}},U={class:"share"},D={class:"container"},E={class:"form-item"},F={class:"form-item"},V={class:"form-item-but"},x={class:"container"},L={key:0,class:"default"},N={key:1},R=["onClick"],M={key:0,class:"default"},B={key:1},O=["onClick"],H=["onClick"],Y=["onClick"];function J(r,e,a,m,o,n){const f=S("router-link"),h=S("tabs-tab"),A=S("tabs");return l(),i("div",U,[p(A,{modelValue:o.activeTab,"onUpdate:modelValue":e[3]||(e[3]=s=>o.activeTab=s)},{default:d(()=>[p(h,{name:"applyForSharing"},{label:d(()=>e[4]||(e[4]=[g("申请共享",-1)])),default:d(()=>[t("div",D,[t("div",E,[t("label",null,[e[5]||(e[5]=g(" 我的设备ID： ",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.config.deviceId=s),disabled:"",style:{color:"white"}},null,512),[[b,o.config.deviceId]])])]),t("div",F,[t("label",null,[e[6]||(e[6]=g(" 对方的设备ID： ",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.deviceId=s),placeholder:"请输入对方的设备ID"},null,512),[[b,o.deviceId]])])]),t("div",V,[t("button",{onClick:e[2]||(e[2]=(...s)=>n.applyForSharing&&n.applyForSharing(...s))},"申请共享")])]),t("div",x,[(o.userApplications||[]).length===0?(l(),i("div",L,"没有设备")):(l(),i("table",N,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"申请的用户名"),t("th",null,"申请的设备名称"),t("th",null,"申请时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),i(y,null,I(o.userApplications,s=>(l(),i("tr",{key:s.id,class:k({"status-yes":s.status===1,"status-no":s.status===2})},[t("td",null,u(s.user_name),1),t("td",null,u(s.device_name),1),t("td",null,u(n.formatTime(s.created_at)),1),t("td",null,[e[8]||(e[8]=t("i",null,null,-1)),p(f,{to:"/device/"+s.device_id},{default:d(()=>e[7]||(e[7]=[t("button",null,"查看",-1)])),_:2,__:[7]},1032,["to"]),t("button",{onClick:v=>n.authorization(s.id,3)},"删除",8,R)])],2))),128))])]))])]),_:1}),p(h,{name:"sharedManagement"},{label:d(()=>e[10]||(e[10]=[g("共享管理",-1)])),default:d(()=>[(o.shareAuthorizations||[]).length===0?(l(),i("div",M,"没有设备")):(l(),i("table",B,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"申请人的用户名"),t("th",null,"申请的设备名称"),t("th",null,"申请时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),i(y,null,I(o.shareAuthorizations,s=>(l(),i("tr",{key:s.id,class:k({"status-yes":s.status===1,"status-no":s.status===2})},[t("td",null,u(s.user_name),1),t("td",null,u(s.device_name),1),t("td",null,u(n.formatTime(s.created_at)),1),t("td",null,[t("button",{onClick:v=>n.authorization(s.id,1)},"同意",8,O),t("button",{onClick:v=>n.authorization(s.id,2)},"拒绝",8,H),t("button",{onClick:v=>n.authorization(s.id,3)},"删除",8,Y)])],2))),128))])]))]),_:1})]),_:1},8,["modelValue"])])}const K=$(C,[["render",J],["__scopeId","data-v-387c9f54"]]);export{K as default};
