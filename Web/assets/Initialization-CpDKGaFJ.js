import{_ as F,r as b,c as p,o as f,a as m,w as o,b as t,d as n,h as d,v,F as S,e as w,t as y,j as U,g as I}from"./index-eDImELfl.js";import{a as c}from"./index-NIGUFBhG.js";import{T as R,a as D}from"./TabsTab-DzuYQ6LR.js";const N={name:"Initialization",components:{TabsTab:D,Tabs:R},data(){return{activeTab:"serverUrl",serverUrl:"",initForm:{refreshInterval:5},loginRegistrationForm:{name:"",password:""},deviceForm:{deviceId:"",name:"",platform:"windows",description:""},devices:[]}},created(){this.init()},methods:{init(){I.emit("sidebarOpen",!1);const r=JSON.parse(localStorage.getItem("config")),e=[["serverUrl","serverUrl"],["refreshInterval","init"],["userId","loginRegistration"],["deviceId","selectDevice"]];if(!r){this.$router.push("/init");return}for(const a of e)if(!r[a[0]]){this.$router.push("/init");return}this.$router.push("/"),I.emit("initConfig"),I.emit("sidebarOpen",!0)},async complete(){this.init()},async ping(){if(this.serverUrl===""){this.$toast.warning("请填写完整信息");return}try{const e=await c.get(`${this.serverUrl}/api/ping`,{validateStatus:()=>!0});if(e.data.code!==0){this.$toast.error("服务器地址错误");return}this.$toast.success(`服务器延迟: ${e.data.message}`)}catch(e){console.error(e),this.$toast.error("服务器地址错误");return}let r=JSON.parse(localStorage.getItem("config"));r={...r,serverUrl:this.serverUrl},localStorage.setItem("config",JSON.stringify(r)),this.activeTab="init"},async saveInit(){if(this.initForm.refreshInterval===""){this.$toast.warning("请填写完整信息");return}let r=JSON.parse(localStorage.getItem("config"));r={...r,refreshInterval:this.initForm.refreshInterval,background:!0},localStorage.setItem("config",JSON.stringify(r)),this.activeTab="loginRegistration"},async loginRegistration(r){if(this.loginRegistrationForm.name===""||this.loginRegistrationForm.password===""){this.$toast.warning("请填写完整信息");return}let e="";r===1?e=`${this.serverUrl}/api/user/login`:e=`${this.serverUrl}/api/user/register`;let a=null;try{const s=await c.post(e,{name:this.loginRegistrationForm.name,password:this.loginRegistrationForm.password},{validateStatus:()=>!0});if(s.data.code!==0){this.$toast.error(s.data.message);return}this.$toast.success(s.data.message),a=s.data.user_id}catch(s){console.error(s),this.$toast.error("登录注册错误");return}let g=JSON.parse(localStorage.getItem("config"));g={...g,userId:a},localStorage.setItem("config",JSON.stringify(g)),this.activeTab="selectDevice",await this.getDevices()},async getDevices(){try{const r=await c.get(`${this.serverUrl}/api/devices/${JSON.parse(localStorage.getItem("config")).userId}`,{validateStatus:()=>!0});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.$toast.success(r.data.message),this.devices=r.data.devices}catch(r){console.error(r)}},async saveDeviceId(r=1){if(this.deviceForm.deviceId===""){this.$toast.warning("请选择设备");return}if(r===2)try{const a=await c.put(`${this.serverUrl}/api/device/update`,{deviceId:this.deviceForm.deviceId,name:this.deviceForm.name,platform:this.deviceForm.platform,description:this.deviceForm.description},{validateStatus:()=>!0});if(a.data.code!==0){this.$toast.error(a.data.message);return}}catch(a){console.error(a),this.$toast.error("保存设备平台错误");return}let e=JSON.parse(localStorage.getItem("config"));e={...e,deviceId:this.deviceForm.deviceId},localStorage.setItem("config",JSON.stringify(e)),await this.complete()},async registrationDevice(){if(this.deviceForm.name===""||this.deviceForm.description===""){this.$toast.warning("请填写完整信息");return}try{const r=await c.post(`${this.serverUrl}/api/device/register`,{ownerID:JSON.parse(localStorage.getItem("config")).userId,deviceName:this.deviceForm.name,platform:this.deviceForm.platform,description:this.deviceForm.description},{validateStatus:()=>!0});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.$toast.success(r.data.message),this.deviceForm.deviceId=r.data.device_id,await this.saveDeviceId(2)}catch(r){console.error(r),this.$toast.error("注册设备错误")}}}},O={class:"initialization"},T={class:"container"},V={class:"form-item"},k={class:"form-item-but"},C={class:"container"},J={class:"form-item"},E={class:"form-item-but"},$={class:"container"},x={class:"form-item"},B={class:"form-item"},z={class:"form-item-but"},L={class:"container"},M={class:"form-item"},j=["value"],G={class:"form-item-but"},Q={class:"container"},q={class:"form-item"},A={class:"form-item"},H={class:"form-item-but"};function K(r,e,a,g,s,l){const u=b("tabs-tab"),h=b("tabs");return f(),p("div",O,[m(h,{modelValue:s.activeTab,"onUpdate:modelValue":e[15]||(e[15]=i=>s.activeTab=i),class:"type"},{default:o(()=>[m(u,{name:"serverUrl"},{label:o(()=>e[16]||(e[16]=[n("服务器地址",-1)])),default:o(()=>[t("div",T,[e[18]||(e[18]=t("h2",null,"测试服务器地址",-1)),t("div",V,[t("label",null,[e[17]||(e[17]=n(" 服务器地址： ",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.serverUrl=i),placeholder:"例如：http://localhost:8080"},null,512),[[v,s.serverUrl]])])]),t("div",k,[t("button",{onClick:e[1]||(e[1]=(...i)=>l.ping&&l.ping(...i))},"测试并保存")])])]),_:1}),m(u,{name:"init"},{label:o(()=>e[19]||(e[19]=[n("初始化设置",-1)])),default:o(()=>[t("div",C,[e[21]||(e[21]=t("h2",null,"初始化设置",-1)),t("div",J,[t("label",null,[e[20]||(e[20]=n(" 自动刷新时间(秒)： ",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.initForm.refreshInterval=i),placeholder:"-1为禁用自动刷新"},null,512),[[v,s.initForm.refreshInterval]])])]),t("div",E,[t("button",{onClick:e[3]||(e[3]=(...i)=>l.saveInit&&l.saveInit(...i))},"保存")])])]),_:1}),m(u,{name:"loginRegistration"},{label:o(()=>e[22]||(e[22]=[n("登录注册",-1)])),default:o(()=>[t("div",$,[e[25]||(e[25]=t("h2",null,"登录注册",-1)),t("div",x,[t("label",null,[e[23]||(e[23]=n(" 用户名： ",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>s.loginRegistrationForm.name=i),placeholder:"请输入用户名"},null,512),[[v,s.loginRegistrationForm.name]])])]),t("div",B,[t("label",null,[e[24]||(e[24]=n(" 密码： ",-1)),d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>s.loginRegistrationForm.password=i),placeholder:"请输入登录密码"},null,512),[[v,s.loginRegistrationForm.password]])])]),t("div",z,[t("button",{onClick:e[6]||(e[6]=i=>l.loginRegistration(1)),style:{"--primary-color":"#3ecd39"}},"登录"),t("button",{onClick:e[7]||(e[7]=i=>l.loginRegistration(2))},"注册")])])]),_:1}),m(u,{name:"selectDevice"},{label:o(()=>e[26]||(e[26]=[n("选择已有设备",-1)])),default:o(()=>[t("div",L,[e[28]||(e[28]=t("h2",null,"选择已有设备",-1)),t("div",M,[d(t("select",{"onUpdate:modelValue":e[8]||(e[8]=i=>s.deviceForm.deviceId=i)},[e[27]||(e[27]=t("option",{value:"",disabled:""},"请选择设备",-1)),(f(!0),p(S,null,w(s.devices,i=>(f(),p("option",{key:i.id,value:i.id},y(i.name),9,j))),128))],512),[[U,s.deviceForm.deviceId]])]),t("div",G,[t("button",{onClick:e[9]||(e[9]=(...i)=>l.saveDeviceId&&l.saveDeviceId(...i)),style:{"--primary-color":"#3ecd39"}},"确定"),t("button",{onClick:e[10]||(e[10]=i=>s.activeTab="registrationDevice")},"注册新的")])])]),_:1}),m(u,{name:"registrationDevice"},{label:o(()=>e[29]||(e[29]=[n("注册新设备",-1)])),default:o(()=>[t("div",Q,[e[32]||(e[32]=t("h2",null,"注册新设备",-1)),t("div",q,[t("label",null,[e[30]||(e[30]=n(" 设备名称： ",-1)),d(t("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>s.deviceForm.name=i),placeholder:"请输入设备名"},null,512),[[v,s.deviceForm.name]])])]),t("div",A,[t("label",null,[e[31]||(e[31]=n(" 设备描述： ",-1)),d(t("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>s.deviceForm.description=i),placeholder:"请输入设备描述"},null,512),[[v,s.deviceForm.description]])])]),t("div",H,[t("button",{onClick:e[13]||(e[13]=(...i)=>l.registrationDevice&&l.registrationDevice(...i)),style:{"--primary-color":"#3ecd39"}},"注册"),t("button",{onClick:e[14]||(e[14]=i=>s.activeTab="selectDevice")},"选择已有设备")])])]),_:1})]),_:1},8,["modelValue"])])}const Y=F(N,[["render",K],["__scopeId","data-v-3ebca3c0"]]);export{Y as default};
