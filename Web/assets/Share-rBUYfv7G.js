import{a as u}from"./index-NIGUFBhG.js";import{_ as k,r as S,c as n,o as l,a as v,w as h,b as t,d as g,h as b,v as _,F as y,e as I,n as w,t as d,g as $}from"./index-RZTBS0IC.js";import{T as z,a as A}from"./TabsTab-BulFDIIk.js";const T={name:"Share",components:{TabsTab:A,Tabs:z},data(){return{activeTab:"applyForSharing",config:{},deviceId:"",shareAuthorizations:[],userApplications:[]}},mounted(){$.on("refresh",this.refresh)},beforeUnmount(){$.off("refresh",this.refresh)},created(){this.refresh()},methods:{refresh(){this.config=JSON.parse(localStorage.getItem("config")),this.getShareAuthorizationList(),this.getUserApplicationsList()},formatTime(r){const e=new Date(r),a=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0"),p=String(e.getSeconds()).padStart(2,"0");return`${a}-${m}-${o} ${i}:${c}:${p}`},async applyForSharing(){if(!window.go){this.$toast.warning("非客户端环境只有只读功能, 不能申请共享");return}if(!this.deviceId){this.$toast.error("请输入对方的设备ID");return}try{const r=await u.post(`${this.config.serverUrl}/api/share/apply`,{deviceId:this.deviceId,viewerId:this.config.userId});if(r.data.code!==0){this.$toast.error(r.data.message);return}this.$toast.success(r.data.message),this.deviceId=""}catch(r){console.error(r),this.$toast.error("申请共享错误")}},async getShareAuthorizationList(){try{const r=await u.get(`${this.config.serverUrl}/api/share/authorizations/${this.config.userId}`);if(r.data.code!==0){this.$toast.error(r.data.message);return}this.shareAuthorizations=r.data.authorizations}catch(r){console.error(r),this.$toast.error("获取共享授权列表错误")}},async authorization(r,e){if(!window.go){this.$toast.warning("非客户端环境只有只读功能, 不能操作共享权限");return}if(e===3)try{const a=await u.delete(`${this.config.serverUrl}/api/share/delete`,{data:{id:r}});if(a.data.code!==0){this.$toast.error(a.data.message);return}this.$toast.success(a.data.message),await this.getShareAuthorizationList()}catch(a){console.error(a),this.$toast.error("删除错误")}else try{const a=await u.put(`${this.config.serverUrl}/api/share/authorize`,{id:r,status:e});if(a.data.code!==0){this.$toast.error(a.data.message);return}this.$toast.success(a.data.message),await this.getShareAuthorizationList()}catch(a){console.error(a),this.$toast.error("授权错误")}},async getUserApplicationsList(){try{const r=await u.get(`${this.config.serverUrl}/api/share/${this.config.userId}`);if(r.data.code!==0){this.$toast.error(r.data.message);return}this.userApplications=r.data.applications}catch(r){console.error(r),this.$toast.error("获取用户申请的授权列表错误")}}}},C={class:"share"},U={class:"container"},D={class:"form-item"},E={class:"form-item"},F={class:"form-item-but"},V={class:"container"},x={key:0,class:"default"},L={key:1},N=["onClick"],R=["onClick"],M=["onClick"],B={key:0,class:"default"},O={key:1},H=["onClick"];function Y(r,e,a,m,o,i){const c=S("tabs-tab"),p=S("tabs");return l(),n("div",C,[v(p,{modelValue:o.activeTab,"onUpdate:modelValue":e[3]||(e[3]=s=>o.activeTab=s)},{default:h(()=>[v(c,{name:"applyForSharing"},{label:h(()=>e[4]||(e[4]=[g("申请共享",-1)])),default:h(()=>[t("div",U,[t("div",D,[t("label",null,[e[5]||(e[5]=g(" 我的设备ID： ",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.config.deviceId=s),disabled:"",style:{color:"white"}},null,512),[[_,o.config.deviceId]])])]),t("div",E,[t("label",null,[e[6]||(e[6]=g(" 对方的设备ID： ",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.deviceId=s),placeholder:"请输入对方的设备ID"},null,512),[[_,o.deviceId]])])]),t("div",F,[t("button",{onClick:e[2]||(e[2]=(...s)=>i.applyForSharing&&i.applyForSharing(...s))},"申请共享")])]),t("div",V,[(o.shareAuthorizations||[]).length===0?(l(),n("div",x,"没有设备")):(l(),n("table",L,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"申请人的用户名"),t("th",null,"申请的设备名称"),t("th",null,"申请时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),n(y,null,I(o.shareAuthorizations,s=>(l(),n("tr",{key:s.id,class:w({"status-yes":s.status===1,"status-no":s.status===2})},[t("td",null,d(s.user_name),1),t("td",null,d(s.device_name),1),t("td",null,d(i.formatTime(s.created_at)),1),t("td",null,[t("button",{onClick:f=>i.authorization(s.id,1)},"同意",8,N),t("button",{onClick:f=>i.authorization(s.id,2)},"拒绝",8,R),t("button",{onClick:f=>i.authorization(s.id,3)},"删除",8,M)])],2))),128))])]))])]),_:1}),v(c,{name:"sharedManagement"},{label:h(()=>e[8]||(e[8]=[g("共享管理",-1)])),default:h(()=>[(o.userApplications||[]).length===0?(l(),n("div",B,"没有设备")):(l(),n("table",O,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"申请的用户名"),t("th",null,"申请的设备名称"),t("th",null,"申请时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),n(y,null,I(o.userApplications,s=>(l(),n("tr",{key:s.id,class:w({"status-yes":s.status===1,"status-no":s.status===2})},[t("td",null,d(s.user_name),1),t("td",null,d(s.device_name),1),t("td",null,d(i.formatTime(s.created_at)),1),t("td",null,[e[9]||(e[9]=t("i",null,null,-1)),e[10]||(e[10]=t("i",null,null,-1)),t("button",{onClick:f=>i.authorization(s.id,3)},"删除",8,H)])],2))),128))])]))]),_:1})]),_:1},8,["modelValue"])])}const G=k(T,[["render",Y],["__scopeId","data-v-a1d97c0f"]]);export{G as default};
